
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Interesting String.GetHashCode() Issue Between ASP.NET 1.1 and 2.0 - Eric Duncan</title>
  <meta name="author" content="Eric Duncan">

  
  <meta name="description" content="Please note that this post was migrated to a new blog platform. There may be bad formating, broken links, images, downloads and so on. If you need &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://eduncan911.com/blog/archives/gethashcode-issue.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Eric Duncan" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3705711-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Eric Duncan</a></h1>
  
    <h2>My name is Eric and I build technology</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:eduncan911.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog Roll</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Interesting String.GetHashCode() Issue Between ASP.NET 1.1 and 2.0</h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-02-01T16:50:00-05:00" pubdate data-updated="true">Feb 1<span>st</span>, 2007</time>
        
      </p>
    
  </header>


<div class="entry-content"><!-- more -->


<blockquote><p>Please note that this post was migrated to a new blog platform. There may be bad formating, broken links, images, downloads and so on.  If you need an item on this page, please contact me and I will do my best to get it from my backups.</p><footer><strong>~E</strong></footer></blockquote>




<P>Today a fellow co-worker, <A class="" href="http://sqladvice.com/blogs/dpenton/" target=_blank mce_href="http://sqladvice.com/blogs/dpenton/">David Penton</A>,&nbsp;ran into an interesting issue about a background&nbsp;ASP.NET&nbsp;thread using ASP.NET 2.0, instead of ASP.NET 1.1 when the individual website was set to run under 1.1.</P>


<P>First a little background.&nbsp; The internal staging server is Windows 2003 R2.&nbsp; In the past&nbsp;Windows 2003 would throw an exception at the web application level when two or more websites were sharing the same application pool, and they were set to different versions of ASP.NET.&nbsp; The R2 release seems to have resolved this issue, hence our IT Administrator running most sites under the common Default Application Pool.</P>


<P>We have a client that requires an ASP.NET 1.1 build of the website.&nbsp; So&nbsp;the developer&nbsp;was working within VS2k3.&nbsp; The background processes in question of the web application is to process the searching algorithm we use for an out-of-the-box CommunityServer install (nicknamed the SearchBarrel).&nbsp; We have an Enterprise Search addon available that uses <FONT size=2>Lucene</FONT>.NET, but for this client they are using the search barrel.&nbsp; The SearchBarrel breaks up a post into individual words, then issues a ToLower() and then GetHashCode() on the string for each word.&nbsp; We store this Int32 hash in the database as number matching is faster to index than string matching.</P>


<P>The String.GetHashCode() method is different between .NET 1.1 and .NET 2.0.&nbsp; So when you are upgrading an application from 1.1 to 2.0, and you are storing the HashCode for strings somewhere, you&#8217;ll have to generate new HashCodes in .NET 2.0.</P>


<P>The issue the developer ran into was very odd.&nbsp; The post was&nbsp;using a mix of English and Chinese, so we are dealing with an extended character set as well.</P>


<BLOCKQUOTE>
<P><FONT face="courier new,courier">(The word we are trying to hash)<BR>ps3对蓝光技术的采用也是令大家称道的原因之一&nbsp;</FONT></P></BLOCKQUOTE>


<P>When a single word mixed English and binary characters without spaces (i.e. Chinese Simplified as above), the background SearchBarrel CSJob (the thread) would generate an ASP.NET&nbsp;2.0 HashCode for the above word!&nbsp;</P>


<BLOCKQUOTE>
<P><FONT face="courier new,courier">(.NET 2.0 HashCode of the word above)<BR>-309760669<BR><BR>(.NET 1.1 HashCode of the word above)<BR><FONT size=2>1104497610</FONT></FONT>&nbsp;</P></BLOCKQUOTE>


<P>Yes, the website was set to ASP.NET 1.1.&nbsp; Yes, the binaries were built under .NET 1.1.&nbsp; But yet, we were getting an .NET 2.0 hashcode.&nbsp; The only thing&nbsp;that came to my mind was&nbsp;that it was using the default application pool, which was shared with many other staging websites - mostly ASP.NET 2.0 sites I&#8217;m guessing (since most of our clients have moved to ASP.NET 2.0).</P>


<P>It gets even odder.&nbsp; If the developer was to edit the post, change that one word of mixed English and Chinese characters to insert a space between the two different languages, clearing the search barrel and letting the background thread re-hash the post - it would then use ASP.NET 1.1 to generate the HashCode!</P>


<P>Very very odd.&nbsp; And we could re-produce it consistently by adding and removing that space and forcing the searchbarrel to rebuild.</P>


<P>The only thing we could guess is that .NET 1.1 choked on the English + Chinese character mix when encoding the hashcode and somehow reverted back to&nbsp;ASP.NET 2.0 to generate the GetHashCode() method.</P>


<P>The fix?&nbsp; Move the website to its own dedicated Application Pool.</P>


<P mce_keep="true"><img alt='Interesting String.GetHashCode() issue between ASP.NET 1.1 and 2.0' src='http://qainsight.net/content/binary/SQA_For_Dummies.jpg'/></P>

</div>


  <footer>

    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Eric Duncan</span></span>

      








  


<time datetime="2007-02-01T16:50:00-05:00" pubdate data-updated="true">Feb 1<span>st</span>, 2007</time>
      

<span class="categories">
  
    <a class='category' href='/category/archives/'>archives</a>, <a class='category' href='/category/blog/'>blog</a>
  
</span>


      

<span class="tags">
  
    Geek StuffComputer ProgrammingCommunity Server
  
</span>


    </p>

    <p><section>
  <h1>Revision History</h1>
  <ul><li><strong>Wed Apr 9 20:49:43 2014</strong><br/>imported into new blog platform
</li></ul>View on <a href=https://github.com/eduncan911/eduncan911.github.io/commits/source/source/_posts/2007-02-01-gethashcode-issue.markdown target=_blank>Github</a>
</section>
</p>

    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/archives/animaniacs-released-to-dvd.html" title="Previous Post: Animaniacs released to DVD!">&laquo; Animaniacs released to DVD!</a>
      
      
        <a class="basic-alignment right" href="/blog/archives/another-mixx-posticon-site-launches.html" title="Next Post: Another PostIcon Site Launches - Soapinions">Another PostIcon Site Launches - Soapinions &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/software/please-put-your-blog-under-source-control.html">Please Put Your Blog Under Source Control</a>
      </li>
    
      <li class="post">
        <a href="/misc/old-pics-have-moved.html">Old Pics Have Moved</a>
      </li>
    
      <li class="post">
        <a href="/hardware/the-wacom-intuos3-slash-4-is-incompatible-with-the-lenovo-helix.html">The Wacom Intuos3/4 Is Incompatible With the Lenovo Helix</a>
      </li>
    
      <li class="post">
        <a href="/software/octopress-powershell-and-posh-git-oh-my.html">Octopress and Posh-Get - Oh My</a>
      </li>
    
      <li class="post">
        <a href="/software/my-hackers-blog.html">My Hackers' Blog</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Eric Duncan -
  Blog content licensed under <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a> - 
  <span class="credit"><a href="/buymeabeer">buy me a beer</a> |
  <a href="/blogtegrity">blogtegrity</a> |
  <a href="/privacy">privacy</a></span>
</p>

</footer>
  











</body>
</html>
